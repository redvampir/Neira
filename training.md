# Загрузка обучающих данных

Этапы обучения описаны в [программе узлов анализа](analysis-nodes.md#программа-обучения-узлов-анализа) и разделе [«Зачаточный этап» дорожной карты](roadmap.md#зачаточный-этап).

## Навигация
- [Обзор](README.md)
- [Узлы действий](action-nodes.md)
- [Узлы анализа](analysis-nodes.md)
- [Узлы памяти](memory-nodes.md)
- [Архитектура анализа](analysis-architecture.md)
- [Системы поддержки](support-systems.md)
- [Личность](personality.md)
- [Шаблон узла](node-template.md)
- [Политика источников](source-policy.md)

## Содержание
- [Загрузка книг](#загрузка-книг)
- [API TeacherClient](#api-teacherclient)
- [Флаги надежности](#флаги-надежности)
- [Процесс ручного резервного вмешательства](#процесс-ручного-резервного-вмешательства)
- [Требования к журналированию](#требования-к-журналированию)

## Загрузка книг
Книги преобразуются в обучающие примеры через простой конвейер:

1. **Извлечение** – получение текста книги в кодировке UTF-8.
2. **Разбиение** – деление на главы или сегменты по 1–2 тыс. символов с метаданными, такими как название и диапазон страниц.
3. **Нормализация** – удаление форматирования, устранение лишних пробелов и проверка, что каждый сегмент укладывается в ограничения модели.
4. **Обогащение** – добавление тегов: жанр, автор, предполагаемые результаты обучения.
5. **Отправка** – отправка каждого сегмента в `TeacherClient` для генерации меток или краткого содержания.

Каждый отправленный сегмент сохраняется вместе с `bookId` и `segmentId` для отслеживаемости.

## API TeacherClient
`TeacherClient` предоставляет интерфейс JSON поверх HTTP для получения учебных ответов.

### Запрос
```json
{
  "bookId": "isbn:9780000000000",
  "segmentId": "ch01-0001",
  "prompt": "Summarize the following segment",
  "text": "<segment contents>",
  "temperature": 0.2
}
```

### Ответ
```json
{
  "bookId": "isbn:9780000000000",
  "segmentId": "ch01-0001",
  "summary": "...",
  "reliability": "medium",
  "tokensUsed": 123
}
```

Поле `reliability` описано в следующем разделе.

## Флаги надежности
Ответы `TeacherClient` содержат флаг `reliability` со следующими значениями:

- `high` – ответ считается достоверным; проверка человеком не требуется.
- `medium` – ответ можно использовать, но следует наблюдать.
- `low` – ответ вероятно неверен; требуется передать учителю-человеку.
- `error` – запрос завершился ошибкой; повторить или передать на рассмотрение.

Приложения, использующие API, должны передавать флаг вместе с сгенерированными данными.

## Процесс ручного резервного вмешательства
Когда возвращается флаг `low` или `error`, система выполняет резервный процесс:

1. Сохранить в журнале проблемный запрос и ответ.
2. Поставить сегмент в очередь на ручную проверку в панели обучения.
3. Уведомить дежурного учителя по электронной почте или в мессенджере.
4. Рецензент-учитель предоставляет исправленный ответ и помечает элемент как `verified`.
5. Проверенный результат заменяет исходный ответ в наборе данных.

## Требования к журналированию
Все взаимодействия с `TeacherClient` и процесс резервного вмешательства должны записываться в файл `logs/training.log` в виде строк JSON.

Пример записи журнала:
```json
{
  "timestamp": "2024-05-24T15:35:22Z",
  "bookId": "isbn:9780000000000",
  "segmentId": "ch01-0001",
  "action": "teacher_response",
  "reliability": "low",
  "durationMs": 532,
  "requestId": "abc123"
}
```

Журнал должен содержать идентификаторы запросов, информацию о времени, флаги надежности и любые вмешательства человека, обеспечивая полную прослеживаемость обучающих данных.

