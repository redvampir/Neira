# Улучшение интерфейсов обучения Neira

<!-- neira:meta
id: NEI-20270515-000001-training-interface-plan
intent: docs
summary: Сформулированы улучшения обучающих интерфейсов, метрики и интеграция с оркестратором.
-->

## Навигация
- [Обзор Нейры](../../README.md)
- [Документация по обучению (сценарный клетка)](../../spinal_cord/TRAINING.md)
- [Загрузка обучающих данных](../guides/training.md)
- [Веб-интерфейс обучения](../guides/web-interface.md)
- [Анти-айдл микрозадачи](../design/anti-idle-system.md)
- [Оркестратор обучения](../../spinal_cord/src/training/orchestrator.rs)

## Оглавление
- [1. Текущее состояние](#1-текущее-состояние)
- [2. Улучшения интерфейса обучения](#2-улучшения-интерфейса-обучения)
  - [2.1 Централизованная панель управления обучением](#21-централизованная-панель-управления-обучением)
  - [2.2 Интерактивный редактор сценариев](#22-интерактивный-редактор-сценариев)
  - [2.3 Инструменты обратной связи преподавателя](#23-инструменты-обратной-связи-преподавателя)
  - [2.4 Аналитика и телеметрия обучения](#24-аналитика-и-телеметрия-обучения)
- [3. Интеграция и архитектура](#3-интеграция-и-архитектура)
- [4. Тестирование и контроль качества](#4-тестирование-и-контроль-качества)
- [5. Риски и шаги развития](#5-риски-и-шаги-развития)

## 1. Текущее состояние

- **Scripted Training** управляется через `TrainingOrchestrator`, который
  подключён к анти-айдл микрозадачам и контролирует допуски по простоям,
  ошибкам и интервалам (`TRAINING_AUTORUN_*`). Подробности в
  [документации сценарного узла обучения](../../spinal_cord/TRAINING.md)
  и исходниках `training::orchestrator`.
- **TeacherClient API** из [руководства по загрузке данных](../guides/training.md#api-teacherclient)
  обеспечивает обмен сегментами и метками, но UI ограничивается базовым
  примером в [веб-интерфейсе обучения](../guides/web-interface.md).
- **Наблюдаемость** сведена к счётчикам `training_iterations_total` и
  `training_converged_total`, плюс журнал `logs/training.log`, без
  агрегированной визуализации и сигналов о деградации качества.

## 2. Улучшения интерфейса обучения

### 2.1 Централизованная панель управления обучением

- Сформировать единый "Learning Dashboard", отображающий очередь задач,
  статус `TrainingOrchestrator`, прогресс сценариев и состояние
  `SynapseHub`. Использовать существующий WebSocket `/ws` для push-обновлений,
  расширив payload событиями `training_progress` и `training_alert`.
- Добавить управление флагами `TRAINING_AUTORUN_*` из UI через защищённые
  REST-эндпоинты, проверяющие режим `safe_mode` и требующие подписи
  администратора.
- Встроить кнопки "Запустить сценарий" и "Поставить на паузу", которые
  инициируют `run_cycle` оркестратора через EventBus команду, избегая
  прямого обращения к внутренним структурам.

### 2.2 Интерактивный редактор сценариев

- Реализовать визуальный конструктор Scripted Training: загрузка YAML,
  проверка схемы и превью шагов. Хранить черновики в `MemoryCell`
  с пометкой `draft`, публиковать изменения через EventBus для синхронных
  узлов.
- Добавить библиотеку готовых шаблонов: запросы TeacherClient, проверки
  метрик, интеграция с `TaskScheduler`.
- Предусмотреть пошаговую отладку: запуск сценария в "dry-run" режиме с
  ручным подтверждением каждого шага и записью результата в отдельный
  канал логов.

### 2.3 Инструменты обратной связи преподавателя

- Расширить панель обучения блоком HITL: список сегментов с флагами
  `reliability` = `low|error`, возможность оставить комментарий,
  загрузить исправленный ответ и задать тег качества.
- Подключить рассылку уведомлений через существующий DiagnosticsCell,
  чтобы преподаватель получал события о новых задачах.
- Добавить статистику по каждому преподавателю: среднее время проверки,
  процент подтверждённых правок, использование шаблонов.

### 2.4 Аналитика и телеметрия обучения

- Вести тепловую карту сценариев: какие шаги чаще всего проваливаются,
  где превышается лимит `max_failures`. Эти данные публиковать в Prometheus
  (лейблы `scenario`, `step`, `failure_reason`).
- Отображать корреляцию между источником данных и качеством ответов:
  графики `reliability` и скорость обработки сегментов.
- Добавить журнал решений EventBus: кто инициировал паузу/перезапуск,
  какие конфигурации применялись.

## 3. Интеграция и архитектура

- Придерживаться существующей шины событий: UI → REST → SynapseHub → EventBus.
  Все команды обучения оборачивать в сообщения `TrainingCommand`, чтобы
  orchestrator оставался изолированным.
- Реализовать слой адаптации для TeacherClient (`training::curriculum`):
  валидация payload, ретраи с экспоненциальной паузой, логи в
  `logs/events.ndjson`.
- Масштабирование: предусмотреть распределённые воркеры Scripted Training
  с блокировками на базе `CellRegistry`, чтобы исключить гонки.

## 4. Тестирование и контроль качества

- Автоматизировать UI-тесты панели обучения (Playwright) с моками API.
- Расширить модульные тесты `TrainingOrchestrator`: сценарии паузы,
  превышения `max_failures`, реакция на `safe_mode`.
- Добавить энд-то-энд тест: полный цикл загрузки сегмента → TeacherClient
  → ручная проверка → обновление в памяти.

## 5. Риски и шаги развития

- **Риски масштабирования**: рост числа сценариев и HITL-задач требует
  очереди (Redis/SQLite) с приоритизацией. Нужна адаптивная настройка
  интервалов автозапуска.
- **Безопасность**: управление флагами обучения должно требовать
  подписанных токенов и протоколировать каждое изменение.
- **Дальнейшие шаги**: после внедрения UI стоит отметить прогресс в
  [дорожной карте](../roadmap.md) и закрепить регламент тестов для новых
  сценариев.
